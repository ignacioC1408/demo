<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="utf-8">
  <title>Carrito - Punto Fácil</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
  <h2>Tu carrito</h2>
  <a class="btn btn-link" href="/usuario/productos">Seguir comprando</a>
  <div th:if="${cart.items.size() == 0}">
    <p>El carrito está vacío.</p>
  </div>

  <table class="table" th:if="${cart.items.size() > 0}">
    <thead><tr><th>Producto</th><th>Unidad</th><th>Cantidad</th><th>Precio unit.</th><th>Subtotal</th><th></th></tr></thead>
    <tbody>
      <tr th:each="item : ${cart.items}">
        <td th:text="${item.nombre}">Nombre</td>
        <td th:text="${item.unidadMedida}">KG</td>
        <td>
          <form method="post" action="/usuario/cart/update" class="d-flex">
            <input type="hidden" name="productoId" th:value="${item.productoId}" />
            <input type="number" name="cantidad" th:value="${item.cantidad}" step="0.1" min="0.1" class="form-control me-2" style="width:120px" />
            <button class="btn btn-primary btn-sm">Actualizar</button>
          </form>
        </td>
        <td>$<span th:text="${#numbers.formatDecimal(item.precioUnitario,2,'POINT')}">0.00</span></td>
        <td>$<span th:text="${#numbers.formatDecimal(item.subtotal,2,'POINT')}">0.00</span></td>
        <td>
          <form method="post" action="/usuario/cart/remove">
            <input type="hidden" name="productoId" th:value="${item.productoId}" />
            <button class="btn btn-danger btn-sm">Eliminar</button>
          </form>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr><td colspan="4" class="text-end"><strong>Total:</strong></td><td colspan="2">$<span th:text="${#numbers.formatDecimal(cart.total,2,'POINT')}">0.00</span></td></tr>
    </tfoot>
  </table>

  <div class="d-flex gap-2">
    <form method="post" action="/usuario/cart/clear">
      <button class="btn btn-outline-danger">Vaciar carrito</button>
    </form>
    <a class="btn btn-success" th:if="${cart.items.size() > 0}" href="/usuario/checkout">Finalizar compra</a>
  </div>
</body>
</html>
