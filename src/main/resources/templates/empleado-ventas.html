<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ventas - Punto Fácil</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="icon" th:href="@{/images/logo.png}" href="/images/logo.png">
  <link rel="stylesheet" th:href="@{/css/panel.css}" href="/css/ventas.css">


</head>

<body class="d-flex flex-column min-vh-100">
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg shadow-sm topbar">
    <div class="container-fluid d-flex justify-content-between align-items-center px-3 px-md-4">
      <div class="d-flex align-items-center gap-2">
        <img th:src="@{/images/logo.png}" src="/images/logo.png" alt="Logo" class="logo">
        <h5 class="m-0 fw-bold text-white">Punto Fácil</h5>
      </div>

      <div class="d-flex align-items-center gap-2">
        <a th:href="@{/empleado/panel/inicio}" class="btn btn-sm text-white"><i class="fas fa-home me-1"></i>Inicio</a>
        <a th:href="@{/empleado/panel/pedidos}" class="btn btn-sm text-white"><i class="fas fa-receipt me-1"></i>Pedidos</a>
        <a th:href="@{/empleado/panel/ventas}" class="btn btn-sm btn-light text-dark"><i class="fas fa-ticket-alt me-1"></i>Ventas</a>
        <div class="text-white small ms-2 d-none d-md-block">
          Bienvenido: <strong th:text="${username}">Usuario</strong> |
          Rol: <strong th:text="${rol}">ADMIN</strong>
        </div>
        <a th:href="@{/empleado/logout}" class="btn btn-sm ms-1 text-white"><i class="fas fa-sign-out-alt me-1"></i>Salir</a>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <main class="container my-4 my-md-5 flex-grow-1">
    <div class="card shadow-sm p-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold m-0"><i class="fas fa-cash-register me-2"></i>Ventas (Pedidos pagados)</h3>
      </div>

      <!-- KPIs -->
      <div class="row g-3 mb-4">
        <!-- Ventas de hoy -->
        <div class="col-12 col-md-6">
          <div class="card shadow-sm border-0 h-100 kpi">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-3">
                <div class="icon" style="background:#e8f7ef;"><i class="fas fa-bolt" style="color:#198754;"></i></div>
                <div>
                  <div class="small text-muted">Ventas de hoy
                    <span class="text-muted" th:text="${#temporals.format(hoy, 'dd/MM/yyyy')}">--/--/----</span>
                  </div>
                  <div class="h5 m-0 fw-bold"
                       th:text="'$' + ${#numbers.formatDecimal(ventasHoy, 0, 'POINT', 2, 'COMMA')}">$0,00</div>
                </div>
              </div>
              <span class="badge bg-success">Hoy</span>
            </div>
          </div>
        </div>

        <!-- Total del rango -->
        <div class="col-12 col-md-6">
          <div class="card shadow-sm border-0 h-100 kpi">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-3">
                <div class="icon" style="background:#e8f0ff;"><i class="fas fa-sack-dollar" style="color:#0d6efd;"></i></div>
                <div>
                  <div class="small text-muted">
                    Total del rango
                    <span th:text="${#temporals.format(desde, 'dd/MM/yyyy')}">--/--/----</span>
                    –
                    <span th:text="${#temporals.format(hasta, 'dd/MM/yyyy')}">--/--/----</span>
                  </div>
                  <div class="h5 m-0 fw-bold"
                       th:text="'$' + ${#numbers.formatDecimal(totalVentas, 0, 'POINT', 2, 'COMMA')}">$0,00</div>
                </div>
              </div>
              <span class="badge bg-primary">Rango</span>
            </div>
          </div>
        </div>
      </div>

      <!-- FILTRO -->
      <form class="row g-3 align-items-end mb-4" th:action="@{/empleado/panel/ventas}" method="get">
        <div class="col-sm-4 col-md-3">
          <label class="form-label small text-muted">Desde</label>
          <input type="date" name="desde" class="form-control form-control-sm" th:value="${desde}" required>
        </div>
        <div class="col-sm-4 col-md-3">
          <label class="form-label small text-muted">Hasta</label>
          <input type="date" name="hasta" class="form-control form-control-sm" th:value="${hasta}" required>
        </div>
        <div class="col-sm-4 col-md-2">
          <button type="submit" class="btn btn-primary w-100 btn-sm">
            <i class="fas fa-filter me-1"></i>Filtrar
          </button>
        </div>
        <!-- Accesos rápidos -->
        <div class="col-12">
        <div class="d-flex flex-wrap gap-2">
            <a th:href="@{'/empleado/panel/ventas'(
                desde=${#temporals.format(hoy, 'yyyy-MM-dd')},
                hasta=${#temporals.format(hoy, 'yyyy-MM-dd')}
              )}" class="btn btn-outline-primary btn-sm">Hoy</a>
        
            <a th:href="@{'/empleado/panel/ventas'(
                desde=${#temporals.format(lunesSemana, 'yyyy-MM-dd')},
                hasta=${#temporals.format(hoy, 'yyyy-MM-dd')}
              )}" class="btn btn-outline-primary btn-sm">Esta semana</a>
        
            <a th:href="@{'/empleado/panel/ventas'(
                desde=${#temporals.format(primerDiaMes, 'yyyy-MM-dd')},
                hasta=${#temporals.format(hoy, 'yyyy-MM-dd')}
              )}" class="btn btn-outline-primary btn-sm">Este mes</a>
        </div>
        </div>
        </form>

      <!-- TABLA -->
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>Total</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="p, iter : ${pedidos}">
              <td th:text="${iter.count}">1</td>
              <td th:text="${p.fecha != null ? #temporals.format(p.fecha, 'dd/MM/yyyy HH:mm') : '--/--/----'}">--/--/----</td>
              <td th:text="${p.usuario != null ? p.usuario.username : '—'}">Cliente</td>
            <td th:text="'$' + ${#numbers.formatDecimal(p.total, 0, 'POINT', 2, 'COMMA')}">$0,00</td>
            <td th:switch="${p.estado.name()}">
                <span th:case="'PAGADO'" class="badge bg-success" th:text="${p.estado}">PAGADO</span>
                <span th:case="'PENDIENTE'" class="badge bg-warning text-dark" th:text="${p.estado}">PENDIENTE</span>
                <span th:case="*" class="badge bg-secondary" th:text="${p.estado}">OTRO</span>
            </td>
            <td>
                <a th:href="@{'/empleado/panel/pedido/' + ${p.id}}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-eye me-1"></i> Ver detalle
                </a>
            </td>
            </tr>
            <tr th:if="${#lists.isEmpty(pedidos)}">
              <td colspan="6" class="text-center text-muted">No hay ventas en el rango seleccionado.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer class="text-center py-3 mt-auto">© 2025 Punto Fácil. Todos los derechos reservados.</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
